(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[47],{"56b4":function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"q-mx-auto register row shadow-4 bg-white rounded-borders",class:{"bg--dark":e.darkOn}},[t("div",{staticClass:"register__background col-sm-6 d-none d-block-sm"}),t("div",{staticClass:"register__form col-12 col-sm-6 q-pa-xl text-grey-9"},[t("q-form",{on:{submit:e.onSubmit}},[t("transition",{attrs:{"enter-active-class":"animated fadeInUpBig slow",appear:""}},[1===e.slide?t("div",{key:1},[t("h1",{staticClass:"text-h4 text-reguluar q-mt-sm",class:{"text-white":e.darkOn}},[e._v("\n            Crie uma conta\n          ")]),t("span",{staticClass:" d-inline-block q-pb-md",class:{"text-white":e.darkOn}},[e._v("\n            crie uma conta e tenha acesso a todos os nossos serviços.\n          ")]),t("InputFullName",{key:1,staticClass:"q-mt-xl",attrs:{fullName:e.fullName,darkOn:e.darkOn},on:{input:function(s){e.fullName=s}}}),t("InputEmail",{attrs:{email:e.email,darkOn:e.darkOn},on:{input:function(s){e.email=s},isValidEmail:function(s){e.isValidEmail=s}}}),t("vue-tel-input",{attrs:{mode:"international",defaultCountry:"br",validCharactersOnly:!0,inputOptions:{placeholder:"Digite seu número de telefone",maxlength:20,required:!0,type:"tel"},styleClasses:["wrapper",{"wrapper--dark":this.$q.dark.isActive},{"vti__dropdown-list--dark":this.$q.dark.isActive}]},model:{value:e.phone,callback:function(s){e.phone=s},expression:"phone"}})],1):2===e.slide?t("div",{key:2},[t("h1",{staticClass:"text-h4 text-reguluar q-mt-md q-pb-lg",class:{"text-white":e.darkOn}},[e._v("\n            Defina sua senha\n          ")]),t("InputPassword",{staticClass:"q-mt-xl",attrs:{passwordObject:{password:e.passwordObject1.password,isPwd:e.passwordObject1.isPwd,label:e.passwordObject1.label},darkOn:e.darkOn},on:{input:function(s){e.passwordObject1.password=s},click:function(s){e.passwordObject1.isPwd=!e.passwordObject1.isPwd}}}),t("InputConfirmPassword",{staticClass:"q-mt-md",attrs:{passwordObject:{password:e.passwordObject2.password,isPwd:e.passwordObject2.isPwd,label:e.passwordObject2.label},confirmedPassword:e.passwordObject1.password,darkOn:e.darkOn},on:{input:function(s){e.passwordObject2.password=s},click:function(s){e.passwordObject2.isPwd=!e.passwordObject2.isPwd}}})],1):t("div",{key:3},[t("h1",{staticClass:"text-h4 text-reguluar q-mt-sm",class:{"text-white":e.darkOn}},[e._v("\n            Autenticação\n          ")]),t("span",{staticClass:" d-inline-block text-h6 q-pb-xl",class:{"text-white":e.darkOn}},[e._v("\n            1º - Verifique seu e-mail "),t("br"),e._v("\n            2º - insira o codigo enviado pro seu telefone\n          ")]),t("q-input",{staticClass:"q-mt-md",attrs:{filled:"",label:"Digite o código enviado por sms",color:e.darkOn?"white":"purple",type:"number",rules:[function(e){return null!==e&&""!==e||"Campo obrigatório"},function(e){return!(e.length>0&&(e.length<6||e.length>6))||"Campo deve ter 6 digítos"}],maxlength:"6"},scopedSlots:e._u([{key:"append",fn:function(){return[t("q-icon",{attrs:{name:"message"}})]},proxy:!0}]),model:{value:e.smsCode,callback:function(s){e.smsCode=s},expression:"smsCode"}}),t("q-btn",{staticClass:"text-capitalize w-100 q-mt-lg",attrs:{type:"submit",label:"Cadastrar",color:"purple",size:"lg",id:"sign-in-button"}})],1)])],1),t("span",{staticClass:"d-block q-mt-md text-right",class:{"text-grey":e.darkOn}},[e._v(e._s(e.slide)+" de 3")]),t("div",{directives:[{name:"show",rawName:"v-show",value:1!==e.slide&&e.showRecaptcha,expression:"slide !== 1 && showRecaptcha"}],staticClass:"row justify-center",attrs:{id:"recaptcha-container"}}),3!==e.slide?t("div",{staticClass:"row justify-center col-12"},[t("q-btn",{staticClass:"text-bold q-ma-sm col-5",attrs:{label:"anterior",color:"purple",size:"md",outline:"",disable:1===e.slide||e.disableBack},on:{click:function(s){return e.back()}}}),t("q-btn",{staticClass:"text-bold q-my-sm col-5",attrs:{label:"Prosseguir",color:"purple",size:"md",disable:3===e.slide||e.disableNext},on:{click:function(s){return e.next()}}})],1):e._e(),3!==e.slide?t("span",{staticClass:"d-inline-block w-100 text-grey  text-center ",class:{"text-grey":e.darkOn}},[t("p",{staticStyle:{margin:"0",padding:"0"}},[e._v("\n        Já é cadastrado?\n      ")]),t("router-link",{staticClass:"text-purple cursor-pointer  ",attrs:{to:"login",tag:"span"}},[t("q-btn",{staticClass:"text-bold text-capitalize   ",staticStyle:{width:"86%"},attrs:{color:"purple",label:"Fazer login",size:"lg","icon-right":"touch_app",flat:""}})],1)],1):e._e(),3===e.slide?t("span",{staticClass:"q-mt-lg d-inline-block w-100 text-center",class:{"text-grey":e.darkOn}},[t("span",[e._v("Não recebeu o SMS?")]),t("q-btn",{staticClass:"q-mx-md",attrs:{label:"Reenviar código",color:"purple",disable:e.disableResend,loading:e.loadingResend},on:{click:function(s){return e.resendSMScode()}}})],1):e._e()],1)])},i=[],o=(t("e6cf"),t("ddb0"),{data(){return{fullName:"",email:"",phone:"",confirmationSMSResult:"",passwordObject1:{password:"",isPwd:!0,label:"Digite sua senha"},passwordObject2:{password:null,isPwd:!0,label:"Confirme sua senha"},emailCode:null,smsCode:null}},methods:{loginWithPhoneNumber(e){e||this.createUserWithEmailAndPassword(),e&&(this.loadingResend=!0,this.showRecaptcha=!0,this.disableResend=!0,this.$q.notify({type:"info",message:"Aguarde 60 segundos até poder reenviar o sms"}),setTimeout((()=>{this.loadingResend=!1,this.disableResend=!1}),8e3));let s=window.recaptchaVerifier;this.$firebase.auth().signInWithPhoneNumber(this.phone,s).then((e=>{this.confirmationSMSResult=e,this.$q.notify({type:"info",message:"SMS enviado"}),this.showRecaptcha=!1})).catch((e=>{console.error(e),console.log(e.code),console.log(e.message),console.log(e),grecaptcha.reset(window.recaptchaWidgetId);let s="auth/too-many-requests"===e.code?"Muitas tentativas, tente novamente mais tarde":"Erro ao enviar o sms";this.$q.notify({type:"negative",message:s}),this.loadingResend=!1}))},createRecaptcha(){window.recaptchaVerifier=new this.$firebase.auth.RecaptchaVerifier("recaptcha-container"),recaptchaVerifier.render().then((e=>{window.recaptchaWidgetId=e}))},createUserWithEmailAndPassword(){this.$firebase.auth().createUserWithEmailAndPassword(this.email,this.passwordObject1.password).then((e=>{this.authUserEmail=e,this.sendEmailVerification()})).catch((e=>{console.error(e);let s="auth/email-already-in-use"===e.code?"Email já está em uso, por favor, faça login":"erro ao enviar email";this.$q.notify({type:"negative",message:s})}))},sendEmailVerification(){let e=this.$firebase.auth().currentUser;e.sendEmailVerification().then((()=>{this.$q.notify({type:"info",message:"Email enviado"}),this.$q.notify({type:"info",message:"O reenvio do sms só poderá ocorrer após 60 segundos"}),this.disableResend=!0,setTimeout((()=>{this.disableResend=!1}),8e3),this.slide++})).catch((e=>{this.$q.notify({type:"negative",message:"Falha ao enviar email"}),console.error(e)}))},resendSMScode(){window.recaptchaVerifier.render().then((e=>{grecaptcha.reset(e),this.loginWithPhoneNumber(!0)}))},onSubmit(){let e=this.$firebase.auth().currentUser;console.log(e),e.reload().then((s=>{e=this.$firebase.auth().currentUser,e.emailVerified?(console.log("email ok"),this.confirmationSMSResult.confirm(this.smsCode).then((e=>{this.authUserPhone=e;let s=!1,t=!1;this.$firebase.firestore().collection("acompanhante").add({no_acompanhante:this.fullName,gn_email:this.email,nu_telefone:this.phone,nu_pontuacao:0,qt_avaliacao:0,md_pontuacao:0},{merge:!0}).then((e=>{this.$q.notify({type:"positive",message:"Cadastro concluído!"}),this.$firebase.firestore().collection("auth").doc(this.authUserEmail.user.uid).set({id_acompanhante:e.id,provedor:"email"}).then((()=>{this.$q.notify({type:"positive",icon:"mail",message:"E-mail registrado!"}),s=!0,s&&t&&(this.$router.push("/"),console.log("to aqui"))})).catch((e=>{console.error(e),console.log(e.message),console.log(e.code)})),this.$firebase.firestore().collection("auth").doc(this.authUserPhone.user.uid).set({id_acompanhante:e.id,provedor:"telefone"}).then((()=>{this.$q.notify({type:"positive",icon:"phone",message:"Telefone registrado!"}),t=!0,s&&t&&(this.$router.push("/"),console.log("to aqui"))})).catch((e=>{console.log(e),console.log(e.message),console.log(e.code)}))})).catch((e=>{console.error(e),console.log(e.message),console.log(e.code),this.$q.notify({type:"negative",message:"erro ao cadastrar usuário"})}))}))):this.$q.notify({type:"negative",message:"Por favor, verifique o seu email"})}))}}}),n={mixins:[o],data(){return{darkOn:!1,slide:1,showRecaptcha:!0,disableBack:!1,disableNext:!1,isValidEmail:!1,nextIsPress:!1,loadingResend:!1,disableResend:!0,authUserEmail:null,authUserPhone:null}},watch:{slide(){3===this.slide&&(this.showRecaptcha=!1)},fullName(){this.validateHasEmptyInputs()},email(){this.validateHasEmptyInputs()},name(){this.validateHasEmptyInputs()},phone(){this.validateHasEmptyInputs()},"passwordObject1.password"(){this.validatePassword()},"passwordObject2.password"(){this.validatePassword()}},components:{InputFullName:()=>t.e(34).then(t.bind(null,"2040")),InputEmail:()=>t.e(33).then(t.bind(null,"988e")),InputPassword:()=>t.e(35).then(t.bind(null,"f41d")),InputConfirmPassword:()=>t.e(32).then(t.bind(null,"1f09"))},methods:{back(){this.slide>1&&this.slide--,1===this.slide&&this.validateHasEmptyInputs()},next(){this.slide<3&&(1===this.slide?(this.slide++,this.nextIsPress||this.createRecaptcha(),this.nextIsPress=!0,this.disableNext=!0,this.validatePassword()):2===this.slide&&(window.grecaptcha.getResponse()?(console.log("loginQithPhoneNumber"),this.loginWithPhoneNumber()):this.$q.notify({type:"negative",message:"Por favor verifique o recaptcha"})))},validateHasEmptyInputs(){let e=0===this.fullName.length||0===this.email.length||0===this.phone.length||!this.isValidEmail;this.disableNext=!!e},validatePassword(){console.log(this.passwordObject1.password==this.passwordObject2.password),this.passwordObject1.password==this.passwordObject2.password&&this.passwordObject1.password.length>=6&&this.passwordObject2.password.length>=6?this.disableNext=!1:this.disableNext=!0}},created(){let e=JSON.parse(localStorage.getItem("isDark"));this.darkOn=e||!1,this.$q.dark.set(this.darkOn),this.validateHasEmptyInputs()}},r=n,l=t("2877"),d=t("0378"),c=t("27f9"),h=t("0016"),p=t("9c40"),u=t("eebe"),m=t.n(u),b=Object(l["a"])(r,a,i,!1,null,null,null);s["default"]=b.exports;m()(b,"components",{QForm:d["a"],QInput:c["a"],QIcon:h["a"],QBtn:p["a"]})}}]);